# Refresh every 5 seconds
set period 5
# Show size and directory information
set info size
set dircounts
# Sixel support
set sixel
# Field separator
# This will most likely shit itself if we encounter a file with \t\n in its name
# but this is so unlikely to happen that I will ignore such possibility (clueless)
set ifs "\t\n"
set filesep "\t\n"
# Enable icons
set icons
# Enable mouse input
set mouse
# Tab is 4 spaces
set tabstop 4

# Previewer config
set previewer ~/.config/lf/previewer.sh
# File opener config
cmd open $~/.config/lf/opener.sh "$f"

cmd unzip %{{
  if [ -e "${f%.*}" ]; then
    echo "${f%.*} already exists"
  else
    mkdir -v "${f%.*}"
    unzip -d "${f%.*}" "$f" > /dev/null
  fi
}}

cmd copy-path &{{
  echo "$f" | wl-copy
}}

cmd copy-file &{{
  file_size=$(stat -c %s "$f")
  size_limit=$((32 * 1024 * 1024)) # 32 megs
  if [ $file_size -gt $size_limit ]; then
    echo "Won't copy ${f}: file size too big"
  else
    wl-copy <"$f"
  fi
}}

cmd make-dir %{{
  echo -n "Directory name: "
  read dirname
  if [ -z "$dirname" ]; then
    exit
  fi
  if [ -d "$dirname" ]; then
    echo "Error:"
    echo "$dirname already exists"
  fi
  
  echo "Creating directory $dirname"
  mkdir --parents "$dirname"
}}

cmd make-file %exec ~/.config/lf/scripts/make-file.sh
cmd make-dir %exec ~/.config/lf/scripts/make-dir.sh
cmd make-symlink %exec ~/.config/lf/scripts/make-symlink.sh

cmd delete %exec ~/.config/lf/scripts/delete.sh
cmd rename %exec ~/.config/lf/scripts/rename.sh
cmd paste %exec ~/.config/lf/scripts/paste.sh

cmd paste-hardlink %exec ~/.config/lf/scripts/paste-link.sh hard
cmd paste-symlink-absolute %exec ~/.config/lf/scripts/paste-link.sh symbolic absolute
cmd paste-symlink-relative %exec ~/.config/lf/scripts/paste-link.sh symbolic relative

cmd chmod %chmod +x "$f"

cmd quit-cd &{{
  echo -n "$PWD" >"$lf_cd_file"
  lf -remote "send $id quit"
}}

map y
map yy copy
map yp copy-path
map yf copy-file

map p
map pp paste
map pl paste-symlink-absolute
map pL paste-symlink-relative
map ph paste-hardlink

map m
map md make-dir
map mf make-file
map ml make-symlink

map Q quit-cd

#set cursoractivefmt "\033[38;2;0,255,0m%s"
